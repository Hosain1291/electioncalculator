<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비례대표 의석수 계산기</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* 요청하신 폰트 적용 */
        @font-face {
            font-family: 'MissedSimsim';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/2511-1@1.0/Griun_Simsimche-Rg.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }

        body { 
            font-family: 'MissedSimsim', 'Noto Sans KR', sans-serif; 
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f5f9; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* Range Input Reset */
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px; width: 16px;
            border-radius: 50%; background: #4f46e5;
            cursor: pointer; margin-top: -4px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- Icons (Inline SVGs for reliability) ---
        const Icon = ({ path, size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {path}
            </svg>
        );

        const Icons = {
            Plus: (props) => <Icon path={<><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>} {...props} />,
            Trash2: (props) => <Icon path={<><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></>} {...props} />,
            Save: (props) => <Icon path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></>} {...props} />,
            Upload: (props) => <Icon path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></>} {...props} />,
            Download: (props) => <Icon path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></>} {...props} />,
            RotateCcw: (props) => <Icon path={<><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></>} {...props} />,
            Calculator: (props) => <Icon path={<><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="8" y1="6" x2="16" y2="6"></line><line x1="16" y1="14" x2="16" y2="14"></line><line x1="12" y1="14" x2="12" y2="14"></line><line x1="8" y1="14" x2="8" y2="14"></line><line x1="16" y1="18" x2="16" y2="18"></line><line x1="12" y1="18" x2="12" y2="18"></line><line x1="8" y1="18" x2="8" y2="18"></line></>} {...props} />,
            Settings: (props) => <Icon path={<><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></>} {...props} />,
            PieChart: (props) => <Icon path={<><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></>} {...props} />,
            Users: (props) => <Icon path={<><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></>} {...props} />,
            AlertCircle: (props) => <Icon path={<><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></>} {...props} />
        };

        // --- 알고리즘 로직 (계산 관련 로직은 동일) ---
        const calculateSeats = (method, parties, totalSeats, threshold, inputType) => {
            let workingParties = parties.map(p => ({
                ...p,
                votes: parseFloat(p.votes) || 0,
                seats: 0
            })).filter(p => p.votes >= 0);

            let totalVotes = workingParties.reduce((sum, p) => sum + p.votes, 0);
            
            const thresholdRate = threshold / 100;
            
            const qualifiedParties = workingParties.map(p => {
                const rate = totalVotes > 0 ? p.votes / totalVotes : 0;
                return {
                    ...p,
                    isQualified: rate >= thresholdRate,
                    rate: rate
                };
            });

            let activeParties = qualifiedParties.filter(p => p.isQualified);
            
            if (activeParties.length === 0) return workingParties;

            if (method === 'dhondt' || method === 'sainte-lague') {
                let rounds = [];
                activeParties.forEach((party, pIndex) => {
                    for (let i = 1; i <= totalSeats; i++) {
                        let divisor;
                        if (method === 'dhondt') divisor = i;
                        else divisor = 2 * i - 1; 
                        
                        rounds.push({
                            partyIndex: pIndex,
                            id: party.id,
                            quotient: party.votes / divisor
                        });
                    }
                });

                rounds.sort((a, b) => b.quotient - a.quotient);

                for (let i = 0; i < totalSeats; i++) {
                    if (rounds[i]) {
                        activeParties[rounds[i].partyIndex].seats++;
                    }
                }

            } else {
                let activeTotalVotes = activeParties.reduce((sum, p) => sum + p.votes, 0);
                let quota = 0;

                switch (method) {
                    case 'hare': quota = activeTotalVotes / totalSeats; break;
                    case 'hagenbach-bischoff': quota = activeTotalVotes / (totalSeats + 1); break;
                    case 'imperiali': quota = activeTotalVotes / (totalSeats + 2); break;
                    case 'droop': quota = Math.floor(activeTotalVotes / (totalSeats + 1)) + 1; break;
                    default: quota = activeTotalVotes / totalSeats;
                }

                let allocatedSeats = 0;
                activeParties.forEach(p => {
                    p.seats = Math.floor(p.votes / quota);
                    p.remainder = p.votes - (p.seats * quota);
                    allocatedSeats += p.seats;
                });

                let remainingSeats = totalSeats - allocatedSeats;
                
                if (remainingSeats > 0) {
                    activeParties.sort((a, b) => b.remainder - a.remainder);
                    for (let i = 0; i < remainingSeats; i++) {
                        if (activeParties[i]) activeParties[i].seats++;
                    }
                }
            }

            const resultMap = new Map(activeParties.map(p => [p.id, p.seats]));
            
            return workingParties.map(p => ({
                ...p,
                seats: resultMap.get(p.id) || 0,
                isQualified: qualifiedParties.find(q => q.id === p.id)?.isQualified || false
            }));
        };

        // --- 반원 차트 컴포넌트 ---
        const HemicycleChart = ({ data, totalSeats }) => {
            const chartData = data.filter(d => d.seats > 0);
            
            if (chartData.length === 0) {
                return (
                    <div className="flex items-center justify-center h-64 text-gray-400 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200">
                        데이터가 없거나 계산되지 않았습니다
                    </div>
                );
            }

            const generatePaths = () => {
                let currentAngle = -180;
                const totalAngle = 180;
                const paths = [];
                
                // 전체 의석수 (할당된 의석 기준)
                const totalAllocated = chartData.reduce((acc, p) => acc + p.seats, 0);
                if (totalAllocated === 0) return [];

                chartData.forEach((party) => {
                    const sliceAngle = (party.seats / totalAllocated) * totalAngle;
                    const endAngle = currentAngle + sliceAngle;
                    
                    const rOuter = 180;
                    const rInner = 100;
                    
                    const startRad = (currentAngle * Math.PI) / 180;
                    const endRad = (endAngle * Math.PI) / 180;
                    
                    const cx = 200;
                    const cy = 200;

                    const x1 = cx + rOuter * Math.cos(startRad);
                    const y1 = cy + rOuter * Math.sin(startRad);
                    const x2 = cx + rOuter * Math.cos(endRad);
                    const y2 = cy + rOuter * Math.sin(endRad);
                    
                    const x3 = cx + rInner * Math.cos(endRad);
                    const y3 = cy + rInner * Math.sin(endRad);
                    const x4 = cx + rInner * Math.cos(startRad);
                    const y4 = cy + rInner * Math.sin(startRad);
                    
                    // Arc flag 계산 수정: 180도일 때도 처리가 필요함
                    // 여기서는 조각이므로 180도를 넘는 경우는 드물지만 (한 정당 독식), 그 경우를 대비
                    const largeArc = sliceAngle > 180 ? 1 : 0;
                    
                    // 소수점 정밀도 문제 방지
                    const safeX1 = Number(x1.toFixed(4));
                    const safeY1 = Number(y1.toFixed(4));
                    const safeX2 = Number(x2.toFixed(4));
                    const safeY2 = Number(y2.toFixed(4));
                    
                    const d = [
                        `M ${x1} ${y1}`,
                        `A ${rOuter} ${rOuter} 0 ${largeArc} 1 ${x2} ${y2}`,
                        `L ${x3} ${y3}`,
                        `A ${rInner} ${rInner} 0 ${largeArc} 0 ${x4} ${y4}`,
                        `Z`
                    ].join(' ');
                    
                    paths.push(
                        <path 
                            key={party.id} 
                            d={d} 
                            fill={party.color} 
                            fillOpacity="1" 
                            stroke="white"
                            strokeWidth="2"
                            className="transition-all duration-300 hover:opacity-80 cursor-pointer"
                        >
                            <title>{`${party.name}: ${party.seats}석`}</title>
                        </path>
                    );
                    
                    currentAngle = endAngle;
                });
                return paths;
            };

            const totalAllocated = chartData.reduce((acc, cur) => acc + cur.seats, 0);

            return (
                <div className="flex flex-col items-center justify-center p-4 w-full">
                    <div className="relative w-full max-w-md aspect-[2/1] overflow-hidden">
                        <svg viewBox="0 0 400 210" className="w-full h-full drop-shadow-sm">
                            {/* 이전 코드의 transform="translate(0, 200)" 제거. 
                                cy가 이미 200으로 계산되므로 또 밀어버리면 안보임 */}
                            <g> 
                                {generatePaths()}
                            </g>
                            <text x="200" y="190" textAnchor="middle" className="text-4xl font-bold fill-gray-800" style={{ fontWeight: '800' }}>
                                {totalAllocated}
                            </text>
                            <text x="200" y="205" textAnchor="middle" className="text-xs fill-gray-500 font-medium tracking-wider">
                                TOTAL SEATS
                            </text>
                        </svg>
                    </div>
                    
                    <div className="flex flex-wrap justify-center gap-3 mt-6">
                        {chartData.map(p => (
                            <div key={p.id} className="flex items-center gap-2 text-sm bg-white px-3 py-1.5 rounded-full shadow-sm border border-gray-200">
                                <span className="w-4 h-4 rounded-full shadow-sm" style={{backgroundColor: p.color}}></span>
                                <span className="font-semibold text-gray-700">{p.name}</span>
                                <span className="font-bold ml-1 text-gray-900 bg-gray-100 px-2 rounded">{p.seats}석</span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 메인 App ---
        function App() {
            const [totalSeats, setTotalSeats] = useState(300);
            const [threshold, setThreshold] = useState(3);
            const [method, setMethod] = useState('dhondt');
            const [inputType, setInputType] = useState('votes');
            
            const [parties, setParties] = useState([
                { id: 1, name: 'A당', votes: 15000000, color: '#3b82f6', seats: 0 },
                { id: 2, name: 'B당', votes: 12000000, color: '#ef4444', seats: 0 },
                { id: 3, name: 'C당', votes: 2000000, color: '#eab308', seats: 0 },
                { id: 4, name: 'D당', votes: 1500000, color: '#22c55e', seats: 0 },
            ]);

            const fileInputRef = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('prCalcData');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        setTotalSeats(parsed.totalSeats);
                        setThreshold(parsed.threshold);
                        setMethod(parsed.method);
                        setParties(parsed.parties);
                        setInputType(parsed.inputType || 'votes');
                    } catch (e) {
                        console.error("Load failed", e);
                    }
                }
            }, []);

            const addParty = () => {
                const newId = Date.now();
                const randomColor = `#${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}`;
                setParties([...parties, { id: newId, name: `신당 ${parties.length + 1}`, votes: 0, color: randomColor, seats: 0 }]);
            };

            const removeParty = (id) => {
                setParties(parties.filter(p => p.id !== id));
            };

            const updateParty = (id, field, value) => {
                setParties(parties.map(p => p.id === id ? { ...p, [field]: value } : p));
            };

            const handleCalculate = () => {
                const results = calculateSeats(method, parties, totalSeats, threshold, inputType);
                setParties(results);
            };

            const handleSaveLocal = () => {
                const data = { totalSeats, threshold, method, parties, inputType };
                localStorage.setItem('prCalcData', JSON.stringify(data));
                alert('브라우저에 저장되었습니다.');
            };

            const handleLoadLocal = () => {
                const saved = localStorage.getItem('prCalcData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    setTotalSeats(parsed.totalSeats);
                    setThreshold(parsed.threshold);
                    setMethod(parsed.method);
                    setParties(parsed.parties);
                    setInputType(parsed.inputType || 'votes');
                } else {
                    alert('저장된 데이터가 없습니다.');
                }
            };

            const handleExportTxt = () => {
                const data = { 
                    meta: { totalSeats, threshold, method, inputType, exportedAt: new Date().toISOString() },
                    parties 
                };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `election_sim_${new Date().toISOString().slice(0,10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const handleImportTxt = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const parsed = JSON.parse(event.target.result);
                        if (parsed.meta) {
                            setTotalSeats(parsed.meta.totalSeats);
                            setThreshold(parsed.meta.threshold);
                            setMethod(parsed.meta.method);
                            setInputType(parsed.meta.inputType);
                            setParties(parsed.parties);
                            alert('파일을 성공적으로 불러왔습니다.');
                        } else {
                            if(parsed.parties) setParties(parsed.parties);
                            else alert('올바르지 않은 파일 형식입니다.');
                        }
                    } catch (err) {
                        alert('파일을 읽는 중 오류가 발생했습니다.');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            };

            const totalVotesSum = parties.reduce((sum, p) => sum + (parseFloat(p.votes) || 0), 0);

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900 pb-20">
                    {/* Header */}
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="bg-gradient-to-br from-indigo-600 to-violet-600 p-2 rounded-lg text-white shadow-md">
                                    <Icons.PieChart size={20} />
                                </div>
                                <h1 className="text-xl font-bold bg-gradient-to-r from-indigo-700 to-violet-700 bg-clip-text text-transparent">
                                    비례대표 의석 계산기
                                </h1>
                            </div>
                            
                            <div className="flex gap-1 md:gap-2">
                                <button onClick={handleSaveLocal} className="p-2 hover:bg-slate-100 rounded-lg text-slate-600 transition-colors" title="로컬 저장">
                                    <Icons.Save size={20} />
                                </button>
                                <button onClick={handleLoadLocal} className="p-2 hover:bg-slate-100 rounded-lg text-slate-600 transition-colors" title="로컬 불러오기">
                                    <Icons.RotateCcw size={20} />
                                </button>
                                <div className="h-6 w-px bg-slate-300 mx-1 self-center hidden md:block"></div>
                                <button onClick={handleExportTxt} className="p-2 hover:bg-slate-100 rounded-lg text-slate-600 transition-colors" title="TXT 내보내기">
                                    <Icons.Download size={20} />
                                </button>
                                <button onClick={() => fileInputRef.current.click()} className="p-2 hover:bg-slate-100 rounded-lg text-slate-600 transition-colors" title="TXT 불러오기">
                                    <Icons.Upload size={20} />
                                </button>
                                <input type="file" ref={fileInputRef} className="hidden" accept=".txt" onChange={handleImportTxt} />
                            </div>
                        </div>
                    </header>

                    <main className="max-w-7xl mx-auto p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 mt-4">
                        
                        {/* Settings & Input */}
                        <div className="lg:col-span-7 space-y-6">
                            
                            {/* Settings Card */}
                            <section className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
                                <div className="flex items-center gap-2 mb-6 text-slate-800 font-bold text-lg border-b border-slate-100 pb-3">
                                    <Icons.Settings size={22} className="text-indigo-600" />
                                    <h2>선거 설정</h2>
                                </div>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div className="space-y-2">
                                        <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider">계산 방식</label>
                                        <div className="relative">
                                            <select 
                                                value={method} 
                                                onChange={(e) => setMethod(e.target.value)}
                                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all appearance-none font-medium text-slate-700"
                                            >
                                                <optgroup label="최고평균법 (Divisor)">
                                                    <option value="dhondt">동트 방식 (D'Hondt)</option>
                                                    <option value="sainte-lague">생트라귀 방식 (Sainte-Laguë)</option>
                                                </optgroup>
                                                <optgroup label="최대잔여법 (Quota)">
                                                    <option value="hare">헤어 쿼터 (Hare)</option>
                                                    <option value="hagenbach-bischoff">하겐바흐-비스초프 (Hagenbach-Bischoff)</option>
                                                    <option value="imperiali">임페리알리 (Imperiali)</option>
                                                </optgroup>
                                            </select>
                                            <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500">
                                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                                            </div>
                                        </div>
                                        <p className="text-xs text-slate-400 pl-1">
                                            {method === 'dhondt' && '대정당에 유리, 일반적 방식'}
                                            {method === 'sainte-lague' && '소수 정당에 유리'}
                                            {method === 'hare' && '직관적인 비례 방식'}
                                            {method === 'imperiali' && '의석 배분이 빠름'}
                                        </p>
                                    </div>

                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">총 의석수</label>
                                            <input 
                                                type="number" 
                                                value={totalSeats} 
                                                onChange={(e) => setTotalSeats(parseInt(e.target.value) || 0)}
                                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none font-semibold text-slate-700"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">봉쇄조항 (%)</label>
                                            <input 
                                                type="number" 
                                                value={threshold} 
                                                onChange={(e) => setThreshold(parseFloat(e.target.value) || 0)}
                                                className="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 outline-none font-semibold text-slate-700"
                                            />
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="mt-6 pt-5 border-t border-slate-100 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                    <div className="flex gap-4 p-1 bg-slate-100 rounded-lg w-fit">
                                        <label className={`flex items-center gap-2 px-3 py-1.5 rounded-md cursor-pointer transition-all ${inputType === 'votes' ? 'bg-white shadow-sm text-indigo-700 font-bold' : 'text-slate-500 hover:text-slate-700'}`}>
                                            <input 
                                                type="radio" 
                                                name="inputType" 
                                                value="votes" 
                                                checked={inputType === 'votes'} 
                                                onChange={() => setInputType('votes')}
                                                className="hidden"
                                            />
                                            <span className="text-sm">득표수</span>
                                        </label>
                                        <label className={`flex items-center gap-2 px-3 py-1.5 rounded-md cursor-pointer transition-all ${inputType === 'percent' ? 'bg-white shadow-sm text-indigo-700 font-bold' : 'text-slate-500 hover:text-slate-700'}`}>
                                            <input 
                                                type="radio" 
                                                name="inputType" 
                                                value="percent" 
                                                checked={inputType === 'percent'} 
                                                onChange={() => setInputType('percent')}
                                                className="hidden"
                                            />
                                            <span className="text-sm">득표율(%)</span>
                                        </label>
                                    </div>
                                    <div className="text-sm font-medium text-slate-500 bg-slate-50 px-3 py-2 rounded-lg border border-slate-100">
                                        {inputType === 'votes' 
                                            ? `총 투표수: ${totalVotesSum.toLocaleString()}표` 
                                            : `총 합계: ${totalVotesSum.toFixed(1)}%`
                                        }
                                    </div>
                                </div>
                            </section>

                            {/* Party List Card */}
                            <section className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center bg-white sticky top-0 z-10">
                                    <div className="flex items-center gap-2 font-bold text-slate-800 text-lg">
                                        <Icons.Users size={22} className="text-indigo-600" />
                                        <h3>정당 목록</h3>
                                    </div>
                                    <button 
                                        onClick={addParty}
                                        className="flex items-center gap-1.5 px-4 py-2 bg-indigo-50 text-indigo-700 text-sm font-bold rounded-xl hover:bg-indigo-100 transition-colors shadow-sm"
                                    >
                                        <Icons.Plus size={18} /> 추가
                                    </button>
                                </div>

                                <div className="divide-y divide-slate-100">
                                    {parties.map((party) => (
                                        <div key={party.id} className="p-4 flex flex-col sm:flex-row items-center gap-4 hover:bg-slate-50 transition-colors group">
                                            {/* Color & Name */}
                                            <div className="flex items-center gap-3 w-full sm:w-auto flex-grow">
                                                <div className="relative">
                                                    <input 
                                                        type="color" 
                                                        value={party.color}
                                                        onChange={(e) => updateParty(party.id, 'color', e.target.value)}
                                                        className="w-10 h-10 rounded-full cursor-pointer border-2 border-slate-200 p-0 overflow-hidden shadow-sm"
                                                    />
                                                </div>
                                                <input 
                                                    type="text" 
                                                    value={party.name} 
                                                    onChange={(e) => updateParty(party.id, 'name', e.target.value)}
                                                    placeholder="정당명"
                                                    className="flex-grow font-semibold bg-transparent border-b-2 border-transparent hover:border-slate-300 focus:border-indigo-500 focus:outline-none px-2 py-1 text-slate-800 transition-colors"
                                                />
                                            </div>
                                            
                                            {/* Votes Input */}
                                            <div className="flex items-center gap-3 w-full sm:w-auto">
                                                <div className="relative flex-grow sm:flex-grow-0 w-full sm:w-48">
                                                    <input 
                                                        type="number" 
                                                        value={party.votes} 
                                                        onChange={(e) => updateParty(party.id, 'votes', e.target.value)}
                                                        className="w-full pl-4 pr-10 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none text-right font-mono text-slate-700"
                                                    />
                                                    <span className="absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm pointer-events-none font-medium">
                                                        {inputType === 'votes' ? '표' : '%'}
                                                    </span>
                                                </div>
                                                
                                                <button 
                                                    onClick={() => removeParty(party.id)}
                                                    className="p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                                    title="삭제"
                                                >
                                                    <Icons.Trash2 size={20} />
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                
                                <div className="p-6 bg-slate-50 border-t border-slate-100">
                                    <button 
                                        onClick={handleCalculate}
                                        className="w-full py-4 bg-gradient-to-r from-indigo-600 to-violet-600 hover:from-indigo-700 hover:to-violet-700 text-white font-bold text-lg rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-0.5 flex items-center justify-center gap-2"
                                    >
                                        <Icons.Calculator size={24} />
                                        결과 계산하기
                                    </button>
                                </div>
                            </section>

                        </div>

                        {/* Results */}
                        <div className="lg:col-span-5 space-y-6">
                            <section className="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 h-full flex flex-col">
                                <div className="flex items-center justify-between mb-6">
                                    <h3 className="font-bold text-xl text-slate-800">예상 의석 분포</h3>
                                    <span className="text-xs font-bold px-3 py-1 bg-indigo-50 text-indigo-600 rounded-full border border-indigo-100 uppercase tracking-wide">
                                        {method.replace('-', ' ')}
                                    </span>
                                </div>

                                <div className="flex-grow flex flex-col items-center justify-center min-h-[300px] bg-slate-50 rounded-2xl p-4 border border-slate-100">
                                    <HemicycleChart data={parties} totalSeats={totalSeats} />
                                </div>

                                <div className="mt-8 space-y-4">
                                    <h4 className="font-bold text-slate-800 text-lg border-b border-slate-100 pb-3">상세 결과</h4>
                                    <div className="space-y-3 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                                        {parties.map((p) => {
                                            const percent = totalVotesSum > 0 ? ((p.votes / totalVotesSum) * 100).toFixed(2) : 0;
                                            return (
                                                <div key={p.id} className={`flex items-center justify-between p-4 rounded-xl border transition-all ${p.isQualified ? 'bg-white border-slate-200 shadow-sm' : 'bg-slate-50 border-slate-100 opacity-60 grayscale'}`}>
                                                    <div className="flex items-center gap-4">
                                                        <div className="w-1.5 h-12 rounded-full" style={{backgroundColor: p.color}}></div>
                                                        <div>
                                                            <div className="font-bold text-slate-900 text-lg">{p.name}</div>
                                                            <div className="text-sm text-slate-500 font-medium">
                                                                {parseFloat(p.votes).toLocaleString()}{inputType === 'votes' ? '표' : '%'} 
                                                                <span className="text-slate-400 mx-1">|</span> 
                                                                {percent}%
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-right">
                                                        <div className="text-2xl font-black text-slate-800">{p.seats}<span className="text-base font-normal text-slate-500 ml-1">석</span></div>
                                                        {!p.isQualified && (
                                                            <div className="flex items-center gap-1 text-xs text-red-500 font-bold justify-end mt-1">
                                                                <Icons.AlertCircle size={12} /> 봉쇄미달
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </section>
                        </div>

                    </main>
                    
                    <footer className="max-w-7xl mx-auto p-6 text-center text-slate-400 text-xs">
                        <p className="mb-1">※ 이 계산기는 시뮬레이션 용도이며 실제 선거 결과와 다를 수 있습니다.</p>
                        <p>디자인: 모던 UI 적용 | 기능: 동트/생트라귀/헤어 등 다양한 알고리즘 지원</p>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
